# **스프링 시큐리티**

우리가 웹사이트나 앱을 안전하게 사용할 수 있게 도와주는 도구입니다. 특히, 누군가 웹사이트에 접근할 때 **이 사람이 누구인지 확인하고**(인증), **이 사람이 어떤 일을 할 수 있는지 확인**(인가)해줍니다. 이제 아주 쉽게 설명해볼게요!

---

### **인증과 인가란 무엇일까요?**

1. **인증(authentication)**: "이 사람이 진짜 이 사람 맞아요?"
    - 예를 들어, 우리가 학교에 들어가려면 **학생증**을 보여줘야 하죠. 학생증을 보여주면 **이 사람이 이 학교 학생이 맞는지** 확인할 수 있어요. 이것을 **인증**이라고 해요.
    - 웹사이트에서도 **로그인**할 때 **사용자의 ID와 비밀번호**를 확인하는 과정이 바로 **인증**입니다. 즉, **이 사람이 진짜 로그인한 사용자가 맞는지**를 확인하는 거예요.
2. **인가(authorization)**: "이 사람이 이 일을 해도 돼요?"
    - 이제 학교 안에 들어왔어요. 그런데 **교무실**이나 **관리실** 같은 곳은 **학생이 들어가면 안 되는 곳**이 있어요. **선생님만** 들어갈 수 있는 곳이죠.
    - 이렇게 **어떤 사람**이 **어떤 일**을 할 수 있는지를 확인하는 게 **인가**입니다. 예를 들어, **일반 사용자는 관리자 페이지에 못 들어가고**, **관리자만** 들어갈 수 있는 것과 같아요.

---

### **스프링 시큐리티는 뭐가 좋을까요?**

스프링 시큐리티는 보안과 관련된 많은 기능을 아주 쉽게 사용할 수 있도록 도와줘요. 그중에서도 몇 가지 중요한 기능을 설명할게요.

### **1. CSRF 공격 방어**

- **CSRF(Cross-Site Request Forgery)** 공격은 웹사이트를 사용하는 우리가 **모르게** 해커가 나쁜 요청을 보내는 공격이에요. 예를 들어, 해커가 우리가 로그인한 상태에서 **나쁜 URL을 클릭**하게 만들어서 나쁜 일을 저지를 수 있죠.
- 스프링 시큐리티는 이런 공격을 막기 위해 **CSRF 토큰**이라는 걸 자동으로 만들어줘요. 이 토큰은 사용자가 요청을 보낼 때 함께 보내는데, 해커는 이 토큰을 모르기 때문에 **해커의 요청은 막히게 되는 거예요**.
- CSRF 보호는 주로 **POST, PUT, DELETE** 같은 **데이터를 바꾸는 요청**에서 사용돼요. 데이터를 바꿀 때 **정상적인 요청**인지 확인하는 거예요.

### **2. 세션 고정 공격 방어**

- **세션**은 우리가 로그인한 후에 **서버가 이 사람은 로그인한 상태**라고 기억하는 거예요. 이 세션이 **유출되면 해커가 우리의 세션을 도용**해서 로그인한 것처럼 행동할 수 있죠.
- 스프링 시큐리티는 이런 걸 막기 위해 **세션 ID를 자주 바꿔줘요**. 로그인할 때마다 **새로운 세션**을 만들어주기 때문에, 해커가 **이전 세션을 훔쳐도** 소용없어요.

### **3. 보안 헤더 설정**

웹사이트에서 **요청**과 **응답**을 주고받을 때, **헤더**라는 부분에 여러 정보를 넣을 수 있어요. 스프링 시큐리티는 이 **헤더를 안전하게 설정**해서 여러 가지 해킹 공격을 막아줘요. 예를 들어, 아래와 같은 보안 설정이 있어요:

1. **X-Frame-Options**: 이 설정은 **다른 웹사이트가 몰래 우리의 사이트를 자기 사이트에 끼워 넣지 못하게** 막아줘요.
2. **X-XSS-Protection**: **XSS 공격**을 막아줘요. XSS는 **해커가 우리 웹사이트에 나쁜 코드를 넣는 공격**이에요. 예를 들어, 아래와 같은 코드를 댓글이나 입력칸에 넣으면 문제가 생길 수 있죠:

    ```html
    <script>alert('악성코드');</script>
    
    ```

   이 코드는 페이지가 실행될 때 해커의 명령대로 팝업이 뜨고, 나쁜 일이 벌어질 수 있어요. 그런데 스프링 시큐리티는 **자동으로 이런 코드를 안전하게 바꿔줘요**. 예를 들어:

    - *<**는 **<**
    - *>**는 **>**
    - *"**는 **"**

   이런 식으로 **특수 문자**를 **안전하게 바꿔**주어서 해커가 넣은 코드가 **그냥 텍스트**처럼 보이게 해요. 이렇게 되면 해커가 아무것도 할 수 없게 돼요.

3. **HSTS**: **HTTPS**만 사용하도록 강제하는 설정이에요. HTTP는 **보안이 약한 통신 방식**이어서 해커가 **중간에서 정보를 훔쳐볼 수 있는 위험**이 있어요. 그래서 스프링 시큐리티는 HTTPS로만 연결하도록 만들어 **통신을 안전하게** 지켜줘요.
4. **Content-Security-Policy(CSP)**: 이 설정은 웹사이트가 **어디서 자원을 가져올 수 있는지** 규칙을 정해줘요. 이를 통해 **허가되지 않은 곳에서 자원을 가져오는** 일을 막아줘요. 예를 들어, 우리 웹사이트가 **신뢰할 수 없는 스크립트**를 실행하지 못하게 해요. 이로 인해 해킹 가능성을 줄일 수 있죠.

---

### **정리하자면...**

- **스프링 시큐리티**는 우리가 만든 웹사이트나 앱을 안전하게 보호해주는 도구예요.
- **인증**은 "이 사람이 맞는가?"를 확인하고, **인가**는 "이 사람이 이걸 할 수 있나?"를 확인하는 과정이에요.
- **CSRF 공격**과 **세션 고정 공격** 같은 해킹 방법을 막아주고, 웹사이트가 안전한 **보안 헤더 설정**을 하도록 도와줘요.
- 우리 웹사이트는 **해킹으로부터 안전**하게 보호되기 때문에, 사용자는 **안심하고 웹사이트를 사용할 수 있답니다!**

이렇게 **스프링 시큐리티**는 우리의 웹사이트를 **튼튼하게 지켜주는 보호막**이 되는 거예요!

### 스프링 시큐리티: 필터 기반 보안 이야기

![AD_4nXfjfftrRH1j9A9P6IiHoDnPMtC8X6sYV_89pOYxNyGhw035h86NdsaRb_Q3D8V2-ZmujYGqvp5oEPrKcxtEnFhfiKXfHhJauDUUsojNQ-X7lQQBhDpARLxd.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/43171377-d611-42fe-9057-4feb210ceb3d/6611ec4c-7959-4fda-93c6-3403e31793e4/AD_4nXfjfftrRH1j9A9P6IiHoDnPMtC8X6sYV_89pOYxNyGhw035h86NdsaRb_Q3D8V2-ZmujYGqvp5oEPrKcxtEnFhfiKXfHhJauDUUsojNQ-X7lQQBhDpARLxd.png)

![](https://i.ibb.co/2sJwQk2/AD-4n-Xfjfftr-RH1j9-A9-P6-Ii-Ho-Dn-PMt-C8-X6s-YV-89p-OYx-Ny-Ghw035h86-Ndsa-Rb-Q3-D8-V2-Zmuj-YGqvp5o.png)

스프링 시큐리티는 웹사이트나 앱에서 **보안을 책임지는 중요한 도구**입니다. 이 도구는 **여러 개의 필터**를 통해 웹 요청이 **안전하게 처리되도록** 도와줍니다. 필터는 웹사이트로 들어오는 요청을 하나씩 확인하고, **인증(이 사람이 누구인지 확인)**과 **인가(이 사람이 이 일을 할 수 있는지 확인)**와 같은 작업을 처리합니다.

---

### 스프링 시큐리티의 필터들: 무슨 일을 하나요?

스프링 시큐리티에는 다양한 필터가 있습니다. 이 필터들은 각자 맡은 일을 하면서 웹 요청이 **안전한지** 확인하고, **해킹**이나 **부정한 접근**을 막아줍니다. 이제 주요 필터들을 설명해볼게요.

---

### 필터 설명

| **필터 이름** | **설명** |
| --- | --- |
| **SecurityContextPersistenceFilter** | 이 필터는 **사용자 정보**(SecurityContext)를 저장하고 불러오는 일을 해요. 누가 로그인했는지 기억하고 있어요. |
| **LogoutFilter** | **사용자가 로그아웃**하려고 할 때, 이 필터가 그 요청을 확인하고 로그아웃 처리를 해줘요. |
| **UsernamePasswordAuthenticationFilter** | **사용자 ID와 비밀번호**로 로그인을 시도할 때 이 필터가 그 요청을 받아서 처리해요. ID와 비밀번호가 맞는지 확인하고, 맞으면 로그인 성공! |
| **DefaultLoginPageGeneratingFilter** | 사용자가 **로그인 페이지**를 따로 만들지 않았다면, 이 필터가 기본 로그인 페이지를 보여줘요. |
| **BasicAuthenticationFilter** | HTTP 요청의 **헤더**에 들어있는 ID와 비밀번호로 사용자를 인증해요. 인증이 성공하면 OK, 실패하면 오류 처리해줘요. |
| **RequestCacheAwareFilter** | 사용자가 로그인을 하기 전에 봤던 페이지로 다시 돌아갈 수 있도록 도와줘요. 예를 들어, 로그인이 끝난 후 **보고 있던 페이지로 돌아가게** 해주는 필터예요. |
| **SecurityContextHolderAwareRequestFilter** | **HttpServletRequest**(웹 요청 객체)를 감싸서 보안 정보를 다른 필터들과 공유할 수 있게 해줘요. |
| **AnonymousAuthenticationFilter** | 만약 인증되지 않은 사용자가 있으면, **익명 사용자**로 만들어서 처리해줘요. 예를 들어, 로그인하지 않은 방문자가 있으면 그 사람을 "익명 사용자"로 처리하는 거예요. |
| **SessionManagementFilter** | 사용자가 로그인하면 그 사용자의 **세션**을 관리해요. 이 세션을 통해 사용자가 로그인 상태를 유지할 수 있게 해줍니다. |
| **ExceptionTranslationFilter** | 요청을 처리하다가 **예외(오류)**가 발생하면, 그 오류를 **다른 필터에게 전달**해서 처리할 수 있게 해줘요. |
| **FilterSecurityInterceptor** | 이 필터는 **인가(authorization)**를 담당해요. 누가 어떤 작업을 할 수 있는지 결정하는 권한을 확인하고, 그 권한에 맞게 접근을 허락하거나 막아요. |

---

### **폼 기반 로그인 절차: 스프링 시큐리티가 어떻게 인증을 처리하나요?**

![AD_4nXfsgXBmN94fOFai-uR03Ui8u08LIYZGdqiFt1upQG3cOkSQxpjtJ2hqxXvQLSp61i83g_4W9Ki5B5XXRe-AgTg-fRrktqHNvfkw8VDaeAS4ks1fuU0jKg3O.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/43171377-d611-42fe-9057-4feb210ceb3d/f65a5379-fe97-44f3-b713-6368cf78d888/AD_4nXfsgXBmN94fOFai-uR03Ui8u08LIYZGdqiFt1upQG3cOkSQxpjtJ2hqxXvQLSp61i83g_4W9Ki5B5XXRe-AgTg-fRrktqHNvfkw8VDaeAS4ks1fuU0jKg3O.png)

![](https://i.ibb.co/GPJDYQj/AD-4n-Xfsg-XBm-N94f-OFai-u-R03-Ui8u08-LIYZGdqi-Ft1up-QG3c-Ok-SQxpjt-J2hqx-Xv-QLSp61i83g-4-W9-Ki5-B5.png)

예를 들어, 웹사이트에서 **ID와 비밀번호로 로그인**하려고 할 때, 스프링 시큐리티가 어떻게 이 절차를 처리하는지 쉽게 설명해볼게요. 아래 그림처럼 여러 단계를 거쳐 로그인이 완료됩니다.

1. **사용자가 ID와 비밀번호를 입력**해서 로그인 버튼을 누릅니다.
2. **AuthenticationFilter**에서 이 입력값을 확인해요. ID와 비밀번호가 입력되었는지 확인하는 거예요.
3. 이 정보를 바탕으로 **UsernamePasswordAuthenticationToken**이 생성돼요. 이건 "이 사용자가 이 ID와 비밀번호를 사용했어요!"라는 정보를 담고 있어요.
4. 이 토큰을 **AuthenticationManager**에게 전달합니다. AuthenticationManager는 "이 사람이 맞는지 더 확실하게 확인해봐야겠어!"라고 판단해요.
5. **AuthenticationProvider**가 이 토큰을 받으면, "어디 보자, 이 사람이 맞는지 확인해보자!" 하고 **UserDetailsService**를 호출해서 실제로 **사용자 정보가 맞는지** 확인합니다.
6. **UserDetailsService**는 **데이터베이스**나 **저장된 정보**를 바탕으로 "맞아요! 이 사람은 이 ID와 비밀번호를 사용하는 사람입니다."라고 알려줘요.
7. 최종적으로 **인증이 성공**하면, 스프링 시큐리티는 사용자를 로그인 상태로 만들어주고, 사용자가 원하는 페이지로 보내줍니다.

---

### **왜 스프링 시큐리티가 중요한가요?**

- **안전한 로그인**: 스프링 시큐리티는 **ID와 비밀번호**를 안전하게 처리하고, **해킹 시도**를 막아줍니다.
- **자동 처리**: 복잡한 보안 절차를 **자동으로 처리**해줘서 개발자가 신경 쓸 필요 없이 **쉽게 보안 기능**을 사용할 수 있어요.
- **다양한 필터**: 다양한 필터들이 각자 역할을 맡아서 **인증, 인가, 로그아웃, 세션 관리** 등을 알아서 처리해줘요.

이렇게 스프링 시큐리티는 **여러 단계의 필터**를 통해 사용자를 인증하고, **안전한 로그인**과 **보안 기능**을 제공합니다.