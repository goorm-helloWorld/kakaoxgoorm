# 6. 스레드 상태 (Thread States)

스레드는 실행 중 다양한 상태를 가질 수 있으며, 각 상태는 스레드의 현재 실행 가능 여부에 따라 결정됩니다. 자바에서는 스레드의 상태를 여러 가지로 정의하며, **스레드 생명주기**에 따른 상태 전이를 이해하는 것이 중요합니다.

## 6.1 **스레드의 주요 상태**

1) **NEW**
    - 스레드가 **생성**되고 아직 시작되지 않은 상태입니다. `start()` 메서드가 호출되지 않았을 때 스레드는 이 상태에 머뭅니다.
    - 예시: `Thread thread = new Thread();`

2) **RUNNABLE**
    - 스레드가 **실행 중이거나 실행 가능한 상태**입니다. CPU에서 실행되기 위한 대기 상태일 수 있으며, JVM이 스레드를 실행하기 위해 스케줄링하는 중입니다.
    - 예시: `thread.start();`

3) **BLOCKED**
    - 스레드가 **동기화 블록**에 의해 잠금(lock) 상태로 대기 중인 상태입니다. 다른 스레드가 자원을 사용하고 있을 때, 자원을 사용하기 위해 잠금이 해제될 때까지 대기합니다.

4) **WAITING**
    - 스레드가 **다른 스레드의 작업을 기다리기 위해** 일시정지된 상태입니다. 이 상태에서는 다른 스레드가 `notify()` 또는 `notifyAll()`을 호출할 때까지 기다립니다.
    - 예시: `wait()` 메서드 호출 시 발생.

5) **TIMED_WAITING**
    - **지정된 시간 동안 대기**하는 상태입니다. 대기 시간이 끝나면 다시 실행 가능한 상태로 돌아갑니다.
    - 예시: `sleep(long millis)` 또는 `wait(long millis)`.

6) **TERMINATED**
    - 스레드가 **작업을 완료**하고 종료된 상태입니다. `run()` 메서드가 종료되면 스레드는 이 상태로 전환됩니다.

---

# 7. 스레드의 실행 제어 (Thread Execution Control)

효율적인 멀티스레드 프로그램을 만들기 위해서는 스레드의 상태를 적절히 제어하는 것이 중요합니다. 자바는 이를 위해 다양한 메서드를 제공합니다.

## 7.1 **주요 메서드**

1) **sleep(long millis) / sleep(long millis, int nanos)**
    - 지정된 시간 동안 스레드를 일시정지시킵니다. 시간이 지나면 스레드는 자동으로 **RUNNABLE 상태**로 돌아옵니다.
    - 예시: `Thread.sleep(2000);` (2초 동안 일시정지)

2) **join() / join(long millis)**
    - 현재 스레드를 일시정지시키고 **다른 스레드가 완료될 때까지 대기**합니다. 시간이 지나거나 해당 스레드의 작업이 종료되면 다시 실행됩니다.
    - 예시: `thread.join();`

3) **interrupt()**
    - 일시정지 상태에 있는 스레드를 깨워서 **실행대기 상태**로 만듭니다. `sleep()`이나 `join()`에 의해 일시정지된 스레드는 `InterruptedException`을 발생시켜 대기 상태를 벗어납니다.
    - 예시: `thread.interrupt();`

4) **stop()**
    - 스레드를 **즉시 종료**시킵니다. 하지만 **비권장**된 방식으로, 자원을 적절히 해제하지 못해 교착 상태(deadlock)나 데이터 손상이 발생할 수 있습니다.

5) **suspend() / resume()**
    - 스레드를 **일시정지**하고, 이후 **재개**시킵니다. 그러나 `suspend()`와 `resume()`은 교착 상태(deadlock)를 유발할 수 있어 **권장되지 않는 메서드**입니다.

6) **yield()**
    - 현재 스레드가 CPU 자원을 **다른 스레드에게 양보**하고 자신은 실행 대기 상태로 돌아갑니다. 이는 스레드 스케줄링을 조정하는 데 유용할 수 있습니다.
    - 예시: `Thread.yield();`

---

## 7.2 **interrupt() 메서드의 동작**

- `interrupt()`는 스레드가 대기 상태를 벗어나도록 요청하는 메서드입니다. 스레드를 강제로 종료시키는 것이 아니라, **스레드의 interrupted 상태를 설정**하여 스레드가 이를 처리할 수 있도록 합니다.
- **InterruptedException**은 `sleep()` 또는 `join()` 중에 발생하며, 스레드는 이 예외를 처리해 대기 상태에서 벗어납니다.

```java
Thread thread = new Thread(() -> {
    try {
        Thread.sleep(5000);  // 5초 동안 대기
    } catch (InterruptedException e) {
        System.out.println("Thread was interrupted!");
    }
});

thread.start();
thread.interrupt();  // 5초가 되기 전에 interrupt로 대기 상태 해제
```

---

## 7.3 **join() 메서드와 실행 제어**

- **join()** 메서드는 현재 스레드를 일시정지시키고, **다른 스레드가 완료될 때까지 대기**하도록 만듭니다. 이 메서드는 특정 작업이 먼저 완료되어야 할 필요가 있을 때 유용하게 사용됩니다.

```java
Thread t1 = new Thread(() -> {
    System.out.println("Thread 1 is running...");
});

Thread t2 = new Thread(() -> {
    try {
        t1.join();  // t1이 완료될 때까지 t2 대기
        System.out.println("Thread 2 is running after Thread 1...");
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
});

t1.start();
t2.start();
```

---

## 7.4 **스레드 상태 요약**

| 상태               | 설명                                                       |
|--------------------|------------------------------------------------------------|
| **NEW**            | 스레드가 생성되고 아직 시작되지 않은 상태                 |
| **RUNNABLE**       | 실행 중이거나 실행 가능한 상태                            |
| **BLOCKED**        | 동기화 블록에 의해 대기 상태 (lock을 기다림)              |
| **WAITING**        | 스레드가 다른 스레드의 신호를 기다리며 일시정지된 상태    |
| **TIMED_WAITING**  | 특정 시간 동안 일시정지된 상태                             |
| **TERMINATED**     | 스레드가 작업을 완료한 상태                                |

### 스레드 제어 메서드 요약

| 메서드              | 설명                                                       |
|---------------------|------------------------------------------------------------|
| **sleep()**         | 지정된 시간 동안 스레드를 일시정지                         |
| **join()**          | 다른 스레드가 완료될 때까지 현재 스레드를 일시정지          |
| **interrupt()**     | 스레드를 깨워서 실행대기 상태로 전환                        |
| **stop()**          | 스레드를 즉시 종료 (비권장)                                 |
| **suspend()**       | 스레드를 일시정지 (비권장)                                  |
| **resume()**        | 일시정지된 스레드를 재개 (비권장)                           |
| **yield()**         | 현재 스레드가 실행 시간을 포기하고 다른 스레드에게 양보      |

---

## 7.5 **결론**

- 스레드 상태와 실행 제어 메서드를 이해하고 활용하는 것은 **효율적인 멀티스레드 프로그래밍**을 위한 기본적인 요소입니다.
- **sleep(), join(), interrupt()** 등의 메서드는 스레드 간 협력과 조정에 중요한 역할을 하며, 비권장된 메서드인 **stop(), suspend(), resume()**의 사용은 피해야 합니다.
- **스레드 상태 관리**는 멀티스레딩에서의 **교착 상태**나 **기아 상태**를 피하는 데 중요한 역할을 합니다.